<app-input-label/>
<div class="column" (mousedown)="onInputContainerMouseDown($event)">
    <div class="top-anchor"><ng-container #topContainer/></div>
    <div #inputContainer class="form-input">
        @if (selectedOption() && !withoutValue()) {
            <div class="value-container row gap-1">
                <div class="value-btn subtle row no-wrap items-center gap-1">
                    @if (valueTemplate) {
                        <ng-container *ngTemplateOutlet="valueTemplate!; context: getValueTemplateContext(selectedOption()!)"/>
                    } @else {
                        <span class="{{selectedOption()!.color}}-text">{{ selectedOption()!.view }}</span>
                    }
                    @if (!disabled() && !hideClear()) {
                        <button class="delete-btn subtle icon-only tiny" type="button" aria-label="Clear selection" (click)="clearSelection()">
                            <app-icon icon="dismiss" size="xs"/>
                        </button>
                    }
                </div>
            </div>
        }
        <ng-content/>
        @if (!disabled()) {
            <input #input type="text" title="Select option" placeholder=" "
                [value]="search()"
                [attr.aria-label]="label() || placeholder() || 'Select option'"
                [attr.title]="label() || placeholder() || 'Select option'"
                [placeholder]="selectedOption() ? '' : placeholder()"
                (focus)="onFocus()"
                (input)="onSearch($event)">
        }
    </div>
    <div class="bottom-anchor"><ng-container #bottomContainer/></div>
</div>
<ng-template #optionsTemplate>
    <div class="options-card input-acrylic-card" animate.leave="leave">
        @if (optionsLoading()) {
            <div>
                <app-icon icon="throbber" size="xs" class="loading-icon"/>
            </div>
        }
        @if (showOptionGroups()) {
            @for (group of visibleOptionGroups(); track group.id) {
                <div class="option-group column">
                    <div class="option-group-title {{group.color ?? 'neutral'}}-text semibold-text"
                        (mousedown)="onGroupTitleMouseDown($event)"
                        (click)="onGroupTitleClick(group, $event)">
                        {{ group.label }}:
                    </div>
                    @for (option of group.options; track (option.id ?? option.value)) {
                        <div #option class="option option-group-item {{option.color}}-text"
                            (click)="selectOption(option, $event)">
                            @if (optionTemplate) {
                                <ng-container *ngTemplateOutlet="optionTemplate!; context: getOptionTemplateContext(option, group)"/>
                            } @else {
                                @for (label of option.highlights; track $index) {
                                    <span [class]="label[1] ? (option.color ?? 'accent') + '-bg highlighted' : ''">{{ label[0] }}</span>
                                }
                            }
                        </div>
                    }
                </div>
            }
        } @else {
            @for (option of visibleOptions(); track (option.id ?? option.value)) {
                <div #option class="option {{option.color}}-text"
                    (click)="selectOption(option, $event)">
                    @if (optionTemplate) {
                        <ng-container *ngTemplateOutlet="optionTemplate!; context: getOptionTemplateContext(option, null)"/>
                    } @else {
                        @for (label of option.highlights; track $index) {
                            <span [class]="label[1] ? (option.color ?? 'accent') + '-bg highlighted' : ''">{{ label[0] }}</span>
                        }
                    }
                </div>
            }
        }
    </div>
</ng-template>